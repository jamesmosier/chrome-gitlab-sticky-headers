{"version":3,"sources":["../../src/js/main.js"],"names":["prToolbarHeight","fileContainers","document","getElementsByClassName","fileHeaders","toggleButtons","collapseText","expandText","getPrToolbarHeight","toolbars","height","i","length","Math","max","getBoundingClientRect","setHeaderTop","fileHeader","topPosition","style","top","resetHeadersFrom","firstIndex","resetAllHeaders","position","width","zIndex","setFileContainersPadding","headerHeight","paddingTop","getCurrentFileContainerIndex","maxBerofeZero","maxBerofeZeroIndex","currentTop","makeCurrentHeaderSticky","currentfileContent","currentFileHeader","newHeaderTop","init","diffFile","onscroll","chrome","runtime","onMessage","addListener","request","type","setTimeout","diffsFiles","querySelector","test","className"],"mappings":";;AAAA;;;;;;AACA;;AAEA,IAAIA,eAAJ;AACA,IAAIC,iBAAiBC,SAASC,sBAAT,CAAgC,aAAhC,CAArB;AACA,IAAIC,cAAcF,SAASC,sBAAT,CAAgC,YAAhC,CAAlB;AACA,IAAIE,gBAAgB,EAApB;AACA,IAAIC,eAAe,UAAnB;AACA,IAAIC,aAAa,QAAjB;;AAEA,IAAMC,qBAAqB,SAArBA,kBAAqB,GAAM;AAC/B,MAAMC,WAAWP,SAASC,sBAAT,CAAgC,oBAAhC,CAAjB;AACA,MAAIO,SAAS,CAAb;AACA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAIF,SAASG,MAA7B,EAAqCD,GAArC,EAA0C;AACxCD,aAASG,KAAKC,GAAL,CAASJ,MAAT,EAAiBD,SAAS,CAAT,EAAYM,qBAAZ,GAAoCL,MAArD,CAAT;AACD;AACD,SAAOA,SAAS,EAAhB;AACD,CAPD;;AASA,IAAIM,eAAe,SAAfA,YAAe,CAASC,UAAT,EAAqBC,WAArB,EAAkC;AACnDD,aAAWE,KAAX,CAAiBC,GAAjB,GAAuBF,cAAc,IAArC;AACD,CAFD;;AAIA,IAAIG,mBAAmB,SAAnBA,gBAAmB,CAASC,UAAT,EAAqB;AAC1C,OAAK,IAAIX,IAAIW,UAAb,EAAyBX,IAAIP,YAAYQ,MAAzC,EAAiDD,GAAjD,EAAsD;AACpDK,iBAAaZ,YAAYO,CAAZ,CAAb,EAA6B,CAA7B;AACD;AACF,CAJD;;AAMA,IAAIY,kBAAkB,SAAlBA,eAAkB,GAAW;AAC/B,OAAK,IAAIZ,IAAI,CAAb,EAAgBA,IAAIP,YAAYQ,MAAhC,EAAwCD,GAAxC,EAA6C;AAC3CP,gBAAYO,CAAZ,EAAeQ,KAAf,CAAqBC,GAArB,GAA2B,KAA3B;AACAhB,gBAAYO,CAAZ,EAAeQ,KAAf,CAAqBK,QAArB,GAAgC,UAAhC;AACApB,gBAAYO,CAAZ,EAAeQ,KAAf,CAAqBM,KAArB,GAA6B,MAA7B;AACArB,gBAAYO,CAAZ,EAAeQ,KAAf,CAAqBO,MAArB,GAA8B,CAA9B;AACD;AACF,CAPD;;AASA,IAAIC,2BAA2B,SAA3BA,wBAA2B,GAAW;AACxC,OAAK,IAAIhB,IAAI,CAAb,EAAgBA,IAAIV,eAAeW,MAAnC,EAA2CD,GAA3C,EAAgD;AAC9C,QAAIiB,eAAexB,YAAYO,CAAZ,EAAeI,qBAAf,GAAuCL,MAA1D;AACAT,mBAAeU,CAAf,EAAkBQ,KAAlB,CAAwBU,UAAxB,GAAqCD,eAAe,IAApD;AACD;AACF,CALD;;AAOA,IAAIE,+BAA+B,SAA/BA,4BAA+B,GAAW;AAC5C,MAAIC,gBAAgB,CAAC,OAArB;AACA,MAAIC,qBAAqB,CAAC,CAA1B;AACA,OAAI,IAAIrB,IAAE,CAAV,EAAaA,IAAEV,eAAeW,MAA9B,EAAsCD,GAAtC,EAA2C;AACzC,QAAIsB,aAAahC,eAAeU,CAAf,EAAkBI,qBAAlB,GAA0CK,GAA3D;AACA,QAAIa,aAAaF,aAAb,IAA8BE,aAAajC,eAA/C,EAAgE;AAC9D+B,sBAAgBE,UAAhB;AACAD,2BAAqBrB,CAArB;AACD;AACF;AACD,SAAOqB,kBAAP;AACD,CAXD;;AAaA,IAAIE,0BAA0B,SAA1BA,uBAA0B,GAAW;AACvC,MAAIF,qBAAqBF,8BAAzB;AACA,MAAIE,uBAAuB,CAAC,CAA5B,EAA+B;AAC7B;AACAT;AACA;AACD;;AAED,MAAIY,qBAAqBlC,eAAe+B,kBAAf,CAAzB;AACA,MAAII,oBAAoBhC,YAAY4B,kBAAZ,CAAxB;AACA,MAAIJ,eAAeQ,kBAAkBrB,qBAAlB,GAA0CL,MAA7D;AACA,MAAI2B,eAAgBF,mBAAmBpB,qBAAnB,GAA2CK,GAA3C,GAAiD,CAAC,CAAnD,GAAuD,CAA1E;;AAEA,MAAIiB,eAAerC,kBAAkB,CAAC,CAAtC,EAAyC;AACvC;AACA;AACD;AACD,MAAIqC,eAAeT,YAAf,GAA8B5B,eAA9B,GAAgDmC,mBAAmBpB,qBAAnB,GAA2CL,MAA/F,EAAuG;AACrG;AACAM,iBAAaoB,iBAAb,EAAgCD,mBAAmBpB,qBAAnB,GAA2CL,MAA3C,GAAoDkB,YAApD,GAAmE,IAAnG;AACA;AACD;;AAEDZ,eAAaoB,iBAAb,EAAgCC,eAAerC,eAA/C;;AAEAqB,mBAAiBW,qBAAqB,CAAtC;AACD,CA1BD;;AA4BA,IAAIM,OAAO,SAAPA,IAAO,GAAW;AACpB,MAAIC,WAAWrC,SAASC,sBAAT,CAAgC,WAAhC,CAAf;AACA,OAAK,IAAIQ,IAAI,CAAb,EAAgBA,IAAI4B,SAAS3B,MAA7B,EAAqCD,GAArC,EAA0C;AACxC4B,aAAS5B,CAAT,EAAYQ,KAAZ,CAAkBK,QAAlB,GAA6B,UAA7B;AACD;;AAEDxB,oBAAkBQ,oBAAlB;AACA,MAAIP,eAAeW,MAAf,KAA0B,CAA9B,EAAiC;AAC/BW;AACAI;AACAzB,aAASsC,QAAT,GAAoBN,uBAApB;AACD,GAJD,MAIO;AACL;AACAhC,aAASsC,QAAT,GAAoB,IAApB;AACD;AACF,CAfD;;AAiBAC,OAAOC,OAAP,CAAeC,SAAf,CAAyBC,WAAzB,CACE,UAASC,OAAT,EAAkB;AAChB,MAAIA,QAAQC,IAAR,KAAiB,MAArB,EAA6B;AAC3B;AACAC,eAAW,YAAW;AACpB,UAAIC,aAAa9C,SAAS+C,aAAT,CAAuB,qBAAvB,CAAjB;AACA,UAAID,cAAc,CAAC,eAAeE,IAAf,CAAoBF,WAAWG,SAA/B,CAAnB,EAA8D;AAC5DH,mBAAWG,SAAX,IAAwB,cAAxB;AACAb;AACD;AACF,KAND,EAMG,IANH;AAOD;AACF,CAZH","file":"contentscript.js","sourcesContent":["import sticky from './sticky';\nsticky();\n\nvar prToolbarHeight;\nvar fileContainers = document.getElementsByClassName('file-holder');\nvar fileHeaders = document.getElementsByClassName('file-title');\nvar toggleButtons = [];\nvar collapseText = 'Collapse';\nvar expandText = 'Expand';\n\nconst getPrToolbarHeight = () => {\n  const toolbars = document.getElementsByClassName('merge-request-tabs');\n  let height = 0;\n  for (var i = 0; i < toolbars.length; i++) {\n    height = Math.max(height, toolbars[0].getBoundingClientRect().height);\n  }\n  return height + 50;\n};\n\nvar setHeaderTop = function(fileHeader, topPosition) {\n  fileHeader.style.top = topPosition + 'px';\n};\n\nvar resetHeadersFrom = function(firstIndex) {\n  for (var i = firstIndex; i < fileHeaders.length; i++) {\n    setHeaderTop(fileHeaders[i], 0);\n  }\n};\n\nvar resetAllHeaders = function() {\n  for (var i = 0; i < fileHeaders.length; i++) {\n    fileHeaders[i].style.top = '0px';\n    fileHeaders[i].style.position = 'absolute';\n    fileHeaders[i].style.width = '100%';\n    fileHeaders[i].style.zIndex = 1;\n  }\n};\n\nvar setFileContainersPadding = function() {\n  for (var i = 0; i < fileContainers.length; i++) {\n    var headerHeight = fileHeaders[i].getBoundingClientRect().height;\n    fileContainers[i].style.paddingTop = headerHeight + 'px';\n  }\n};\n\nvar getCurrentFileContainerIndex = function() {\n  var maxBerofeZero = -1000000;\n  var maxBerofeZeroIndex = -1;\n  for(var i=0; i<fileContainers.length; i++) {\n    var currentTop = fileContainers[i].getBoundingClientRect().top;\n    if (currentTop > maxBerofeZero && currentTop < prToolbarHeight) {\n      maxBerofeZero = currentTop;\n      maxBerofeZeroIndex = i;\n    }\n  }\n  return maxBerofeZeroIndex;\n};\n\nvar makeCurrentHeaderSticky = function() {\n  var maxBerofeZeroIndex = getCurrentFileContainerIndex();\n  if (maxBerofeZeroIndex === -1) {\n    // reset the headers if we scroll back before the first one\n    resetAllHeaders();\n    return;\n  }\n\n  var currentfileContent = fileContainers[maxBerofeZeroIndex];\n  var currentFileHeader = fileHeaders[maxBerofeZeroIndex];\n  var headerHeight = currentFileHeader.getBoundingClientRect().height;\n  var newHeaderTop = (currentfileContent.getBoundingClientRect().top * -1) -1;\n\n  if (newHeaderTop < prToolbarHeight * -1) {\n    // We reached the top of the file scrolling up\n    return;\n  }\n  if (newHeaderTop + headerHeight + prToolbarHeight > currentfileContent.getBoundingClientRect().height) {\n    // We reached the bottom of the file scrolling down\n    setHeaderTop(currentFileHeader, currentfileContent.getBoundingClientRect().height - headerHeight + 'px');\n    return;\n  }\n\n  setHeaderTop(currentFileHeader, newHeaderTop + prToolbarHeight);\n\n  resetHeadersFrom(maxBerofeZeroIndex + 1);\n};\n\nvar init = function() {\n  var diffFile = document.getElementsByClassName('diff-file');\n  for (var i = 0; i < diffFile.length; i++) {\n    diffFile[i].style.position = 'relative';\n  }\n\n  prToolbarHeight = getPrToolbarHeight();\n  if (fileContainers.length !== 0) {\n    resetAllHeaders();\n    setFileContainersPadding();\n    document.onscroll = makeCurrentHeaderSticky;\n  } else {\n    // remove onscroll listener if no file is present in the current page\n    document.onscroll = null;\n  }\n};\n\nchrome.runtime.onMessage.addListener(\n  function(request) {\n    if (request.type === 'init') {\n      // loading spinner mr-loading-status\n      setTimeout(function() {\n        var diffsFiles = document.querySelector('.merge-request-tabs');\n        if (diffsFiles && !/sticky-init/g.test(diffsFiles.className)) {\n          diffsFiles.className += ' sticky-init';\n          init();\n        }\n      }, 2500);\n    }\n  }\n);\n"]}